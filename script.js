let resources=[];const API_URL="https://resourceshub-backend.onrender.com/api/resources",subjectsBySem={1:["DBMS","C Programming","Python","OE","English"],2:["Electronics","Mathematics","RDBMS","Advance C Programming","Software Engineering","Data Science"],3:["Web Dev","Operating Systems","Java"]};let currentCategoryFilter="all";function toggleMobileMenu(){document.body.classList.toggle("mobile-nav-open")}async function fetchResources(){let e=document.getElementById("resourceGrid");try{e&&(e.innerHTML=`<div style="grid-column:1/-1; text-align:center; padding: 4rem;">
                <i class="fas fa-spinner fa-spin" style="font-size:2rem; color: var(--primary);"></i>
                <p style="margin-top:1rem; color: var(--text-gray);">Loading library...</p>
            </div>`);let t=await fetch("https://resourceshub-backend.onrender.com/api/resources");if(!t.ok)throw Error("Failed to fetch data");resources=await t.json(),e&&(updateSubjects(),filterResources())}catch(n){console.error("Error loading resources:",n),e&&(e.innerHTML=`
                <div style="grid-column:1/-1; text-align:center; padding: 4rem; color:#EF4444;">
                    <i class="fas fa-exclamation-circle" style="font-size:2rem; margin-bottom:1rem;"></i>
                    <p>Failed to connect to the server.<br>Please try again later.</p>
                    <button type="button" onclick="window.location.reload();" class="btn-secondary">Refresh Page</button>
                </div>`)}}if(document.getElementById("resourceGrid")){function e(e){let t=e.toLowerCase();return t.includes("c++")||t.includes("electronics")||t.includes("c programming")?".cpp":t.includes("python")?".py":t.includes("java")&&!t.includes("script")?".java":t.includes("sql")?".sql":t.includes("html")?".html":t.includes("css")?".css":".txt"}function t(e){if(e.dataset.isAnimating)return;let t=e.innerHTML;e.style.width=getComputedStyle(e).width,e.innerHTML='<i class="fas fa-check" style="color: #10B981;"></i>',e.dataset.isAnimating="true",setTimeout(()=>{e.innerHTML=t,e.style.width="",delete e.dataset.isAnimating},2e3)}function n(e,t){if(!e)return"";e=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");let n=t.toLowerCase(),l=(e,t)=>`<span class="${t}">${e}</span>`;return e=n.includes("sql")||n.includes("dbms")?(e=e.replace(/('.*?')|(--.*$)/gm,(e,t,n)=>t?l(t,"str"):n?l(n,"cmt"):e)).replace(/\b(SELECT|FROM|WHERE|INSERT|INTO|VALUES|UPDATE|DELETE|CREATE|DROP|ALTER|TABLE|INDEX|VIEW|JOIN|INNER|OUTER|LEFT|RIGHT|ON|GROUP|BY|ORDER|HAVING|LIMIT|OFFSET|UNION|ALL|DISTINCT|AS|AND|OR|NOT|NULL|PRIMARY|KEY|FOREIGN|REFERENCES|DEFAULT|CHECK|CONSTRAINT|BEGIN|COMMIT|ROLLBACK|TRANSACTION|GRANT|REVOKE)\b/gi,e=>l(e,"kwd")):n.includes("python")?(e=e.replace(/(".*?")|('.*?')|(#.*$)/gm,(e,t,n,r)=>t||n?l(e,"str"):r?l(r,"cmt"):e)).replace(/\b(def|class|if|elif|else|while|for|in|try|except|finally|with|as|import|from|return|pass|break|continue|lambda|yield|global|nonlocal|assert|del|or|and|not|is|None|True|False|self|print|len|range|open|str|int|float|list|dict|set|super)\b/g,e=>l(e,"kwd")):n.includes("java")&&!n.includes("script")?(e=e.replace(/(".*?")|(\/\/.*$)/gm,(e,t,n)=>t?l(t,"str"):n?l(n,"cmt"):e)).replace(/\b(public|private|protected|static|final|void|int|double|float|char|boolean|byte|short|long|class|interface|enum|extends|implements|new|this|super|return|if|else|switch|case|default|while|do|for|break|continue|try|catch|finally|throw|throws|package|import|null|true|false|abstract|synchronized|volatile|transient|native)\b/g,e=>l(e,"kwd")):n.includes("c++")||n.includes("c programming")||n.includes("arduino")||n.includes("electronics")?(e=e.replace(/(".*?")|(\/\/.*$)|(#.*$)/gm,(e,t,n,r)=>t?l(t,"str"):n?l(n,"cmt"):r?l(r,"kwd"):e)).replace(/\b(int|float|double|char|void|long|short|unsigned|signed|const|static|volatile|if|else|switch|case|default|while|do|for|break|continue|return|goto|typedef|struct|union|enum|class|public|private|protected|virtual|friend|this|new|delete|namespace|using|template|typename|try|catch|throw|sizeof|true|false|bool|nullptr)\b/g,e=>l(e,"kwd")):n.includes("html")?(e=(e=e.replace(/(&lt;!--.*?--&gt;)/gs,e=>l(e,"cmt"))).replace(/(&lt;\/?)([a-z0-9]+)(.*?)?(&gt;)/gi,(e,t,n,r,a)=>`${t}${l(n,"kwd")}${r}${a}`)).replace(/\s([a-z0-9-]+)=/gi,(e,t)=>` <span class="str">${t}</span>=`):n.includes("css")?(e=e.replace(/(\/\*[\s\S]*?\*\/)/g,e=>l(e,"cmt"))).replace(/([\w-]+)\s*:/g,(e,t)=>`${l(t,"kwd")}:`):(e=e.replace(/(".*?")|('.*?')|(`[\s\S]*?`)|(\/\/.*$)/gm,(e,t,n,r,a)=>t||n||r?l(e,"str"):a?l(a,"cmt"):e)).replace(/\b(const|let|var|function|return|if|else|for|while|do|switch|case|break|continue|try|catch|finally|throw|new|this|class|extends|super|import|export|from|default|async|await|typeof|instanceof|void|delete|in|of|null|undefined|true|false|NaN|console|window|document|Math|JSON)\b/g,e=>l(e,"kwd"))}window.addEventListener("DOMContentLoaded",fetchResources),window.updateSubjects=function(){let e=document.getElementById("semFilter"),t=document.getElementById("subjectFilter");if(!e||!t)return;let n=e.value;t.innerHTML='<option value="all">All Subjects</option>';let l=[];if("all"===n){let r=Object.values(subjectsBySem).flat();l=[...new Set(r)]}else subjectsBySem[n]&&(l=subjectsBySem[n]);l.forEach(e=>{let n=document.createElement("option");n.value=e,n.textContent=e,t.appendChild(n)}),filterResources()},window.setCategory=function(e,t){document.querySelectorAll(".pill").forEach(e=>e.classList.remove("active")),t.classList.add("active"),currentCategoryFilter=e,filterResources()},window.hideElement=function(){let e=document.getElementById("codeAction");e&&(e.style.display="none"),document.body.style.overflow="auto"},window.showElement=function(){let e=document.getElementById("codeAction");e&&(e.style.display="flex"),document.body.style.overflow="hidden"},window.showToast=function(e,t="info"){let n=document.getElementById("toast"),l=document.getElementById("toastMsg"),r=n.querySelector("i");l.innerText=e,"success"===t?(r.className="fas fa-check-circle",r.style.color="#10B981"):(r.className="fas fa-info-circle",r.style.color="#4F46E5"),n.classList.add("show"),setTimeout(function(){n.classList.remove("show")},3e3)},window.handleCopy=function(e,n){let l=document.getElementById(n);if(!l)return console.error(`Target ID ${n} not found`);navigator.clipboard.writeText(l.innerText).then(()=>{t(e),showToast("Code copied to clipboard!","success")}).catch(e=>{console.error("Copy failed",e),showToast("Failed to copy code","error")})},window.handleDownload=function(e,n){let l=document.getElementById(n);if(!l)return;let r=l.innerText,a=e.getAttribute("data-filename")||"snippet.txt",o=new Blob([r],{type:"text/plain"}),i=window.URL.createObjectURL(o),s=document.createElement("a");s.href=i,s.download=a,document.body.appendChild(s),s.click(),window.URL.revokeObjectURL(i),document.body.removeChild(s),t(e),showToast(`Downloading ${a}...`,"success")},window.loadCodeToSidebar=function(t){let l=resources.find(e=>String(e.id)===String(t));if(!l)return;let r=l.source||"// No code available for this item.",a=n(r,l.tag),o=l.title.replace(/[^a-z0-9]/gi,"_").toLowerCase(),i=e(l.tag),s=`${o}${i}`,c=document.getElementById("mobileCodeBlock"),d=document.getElementById("mobileWidgetTitle"),u=document.getElementById("mobileDownloadBtn");d&&(d.innerHTML=`<i class="fas fa-code text-yellow"></i> ${l.title}`),c&&(c.innerHTML=a),u&&u.setAttribute("data-filename",s);let p=document.getElementById("sidebarCodeBlock"),g=document.getElementById("widgetTitle"),f=document.getElementById("desktopDownloadBtn");g&&(g.innerHTML=`<i class="fas fa-code text-yellow"></i> ${l.title.substring(0,20)}...`),p&&(p.innerHTML=a),f&&f.setAttribute("data-filename",s),window.innerWidth<768&&showElement()},window.filterResources=function(){let e=document.getElementById("resourceGrid"),t=document.getElementById("searchInput"),n=document.getElementById("semFilter"),l=document.getElementById("subjectFilter");if(!e)return;let r=t?t.value.toLowerCase():"",a=n?n.value:"all",o=l?l.value:"all";e.innerHTML="";let i=resources.filter(e=>{let t=e.title.toLowerCase().includes(r)||e.tag.toLowerCase().includes(r),n="all"===a||String(e.sem)===String(a),l="all"===o||e.subject===o,i=!1;return i="all"===currentCategoryFilter||(["Book","Paper"].includes(currentCategoryFilter)?e.type===currentCategoryFilter:e.tag.includes(currentCategoryFilter)),t&&n&&l&&i});if(0===i.length){e.innerHTML=`
                <div style="grid-column:1/-1; text-align:center; padding: 4rem; color:#6B7280;">
                    <i class="fas fa-search" style="font-size:2rem; margin-bottom:1rem; opacity:0.5;"></i>
                    <p>No resources found for this criteria.</p>
                </div>`;return}i.forEach(t=>{let n="",l="fa-file-alt",r="bg-gray";"Code"===t.type?(n=`<button onclick="loadCodeToSidebar('${t.id}')" class="btn-small">View Code</button>`,l="fa-code",r="bg-teal"):"Book"===t.type?(n=`<button onclick="downloadPDF('${t.source}', '${t.title}')" class="btn-small">Download PDF</button>`,l="fa-book",r="bg-red"):(n=`<button onclick="downloadPDF('${t.source}', '${t.title}')" class="btn-small">Download Paper</button>`,l="fa-file-contract",r="bg-orange");let a=`
                <div class="card" id="card-${t.id}">
                    <div class="card-top">
                        <div class="card-icon ${r}">
                            <i class="fas ${l}"></i>
                        </div>
                        <span class="tag" style="font-size:0.75rem; font-weight:600; color:#6B7280; background:#F3F4F6; padding:4px 8px; border-radius:6px;">${t.tag}</span>
                    </div>
                    <h4>${t.title}</h4>
                    <div class="meta-info">
                        <span><i class="fas fa-layer-group"></i> Sem ${t.sem}</span>
                        <span>â€¢</span>
                        <span>${t.subject}</span>
                    </div>
                    ${n}
                </div>
            `;e.innerHTML+=a})};let l=new URLSearchParams(window.location.search),r=l.get("q");r&&(document.getElementById("searchInput").value=r);let a=l.get("sem");if(a){let o=document.getElementById("semFilter");o&&(o.value=a,"function"==typeof window.updateSubjects&&window.updateSubjects())}let i=l.get("cat");i&&(currentCategoryFilter=i,setTimeout(()=>{document.querySelectorAll(".pill").forEach(e=>{e.classList.remove("active"),(e.getAttribute("onclick").includes(`'${i}'`)||e.innerText===i)&&e.classList.add("active")})},100))}if(window.performHomeSearch=function(){let e=document.getElementById("homeSearchInput");e&&""!==e.value.trim()&&(window.location.href=`resources.html?q=${encodeURIComponent(e.value)}`)},document.getElementById("dropZone")){let s=document.getElementById("dropZone"),c=document.getElementById("fileInput");s.addEventListener("click",()=>c.click()),s.addEventListener("dragover",e=>{e.preventDefault(),s.style.borderColor="#4F46E5",s.style.background="#EEF2FF"}),s.addEventListener("dragleave",e=>{s.style.borderColor="#E5E7EB",s.style.background="#F9FAFB"}),s.addEventListener("drop",e=>{e.preventDefault(),s.style.borderColor="#10B981",s.style.background="#ECFDF5"}),window.handleUpload=function(e){e.preventDefault();let t=e.target.querySelector("button"),n=t.innerHTML;t.innerHTML='<i class="fas fa-spinner fa-spin"></i> Uploading...',t.style.opacity="0.8",setTimeout(()=>{alert("Thanks for contributing! Your resource is under review."),t.innerHTML=n,t.style.opacity="1",e.target.reset(),s.style.background="#F9FAFB",s.style.borderColor="#E5E7EB"},1500)}}async function downloadPDF(e,t){let n=document.activeElement,l=n?n.innerText:"Download",r=e;e.includes("supabase.co")&&(r=e.includes("?")?`${e}&download=`:`${e}?download=`);try{n&&(n.innerText="Downloading..."),window.location.href=r,setTimeout(()=>{n&&(n.innerText="Saved!")},2e3),setTimeout(()=>{n&&(n.innerText=l)},4e3),showToast("Downloading PDF","success")}catch(a){console.error("Download error:",a),window.open(r,"_blank"),n&&(n.innerText=l),showToast("Error: Download Failed","failure")}}
